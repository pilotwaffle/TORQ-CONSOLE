FROM python:3.11-slim

WORKDIR /app

# Install only the lightweight deps needed by api/index.py
COPY requirements-vercel.txt .
RUN pip install --no-cache-dir -r requirements-vercel.txt

# Copy ONLY the Vercel entry point (NOT the full torq_console package)
COPY api/index.py ./api/index.py

ENV PYTHONUNBUFFERED=1
ENV TORQ_CONSOLE_PRODUCTION=true
ENV TORQ_DISABLE_LOCAL_LLM=true
ENV TORQ_DISABLE_GPU=true

EXPOSE 8000

CMD ["uvicorn", "api.index:app", "--host", "0.0.0.0", "--port", "8000"]
