<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TORQ Console Dashboard</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        :root{--bg:#0c0a13;--bg2:rgba(0,0,0,0.3);--bg3:rgba(255,255,255,0.04);--bdr:rgba(255,255,255,0.06);--bdr-a:rgba(139,92,246,0.2);--t1:#e2e8f0;--t2:rgba(255,255,255,0.6);--t3:rgba(255,255,255,0.3);--t4:rgba(255,255,255,0.15);--ac:#7c3aed;--ac2:#a78bfa;--acbg:rgba(139,92,246,0.08);--ok:#22c55e;--err:#ef4444;--sans:'Inter',-apple-system,sans-serif;--mono:'JetBrains Mono','Fira Code',monospace}
        body{font-family:var(--sans);background:var(--bg);color:var(--t1);height:100vh;overflow:hidden}
        ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(139,92,246,0.2);border-radius:4px}
        ::selection{background:rgba(139,92,246,0.3)}
        @keyframes pulse{0%,80%,100%{opacity:.3;transform:scale(.8)}40%{opacity:1;transform:scale(1)}}

        .app{display:flex;flex-direction:column;height:100vh}
        .topnav{height:48px;padding:0 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--bdr);background:rgba(0,0,0,0.2);flex-shrink:0}
        .tnl,.tnr{display:flex;align-items:center;gap:12px}
        .sbtgl{width:32px;height:32px;border-radius:6px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:var(--t2);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center}
        .logo{display:flex;align-items:center;gap:8px}
        .lm{width:28px;height:28px;border-radius:6px;background:linear-gradient(135deg,#7c3aed,#2563eb);display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;color:#fff;font-family:var(--mono)}
        .lt{font-size:15px;font-weight:700;letter-spacing:-0.02em}
        .lv{font-size:10px;color:rgba(139,92,246,0.6);font-family:var(--mono);font-weight:500}
        .sdot{width:6px;height:6px;border-radius:50%;display:inline-block;margin-right:4px}
        .slbl{font-size:10px;font-family:var(--mono)}
        .pi{display:none;align-items:center;gap:6px}.pi.on{display:flex}
        .pd{width:7px;height:7px;border-radius:50%;background:var(--ac2);animation:pulse 1.2s ease-in-out infinite}
        .pl{font-size:11px;color:rgba(139,92,246,0.7);font-family:var(--mono)}

        .mn{display:flex;flex:1;overflow:hidden}
        .sb{width:260px;height:100%;background:var(--bg2);border-right:1px solid var(--bdr);display:flex;flex-direction:column;overflow:hidden;flex-shrink:0;transition:width .2s,opacity .2s}
        .sb.off{width:0;opacity:0;overflow:hidden}
        .sbs{padding:4px 12px}
        .sbl{font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;font-weight:600;margin-bottom:4px}
        .ssel{width:100%;padding:6px 8px;margin-top:4px;border-radius:6px;border:1px solid rgba(255,255,255,0.08);background:var(--bg3);color:var(--t1);font-size:12px;font-family:var(--sans);outline:none;cursor:pointer;appearance:none;-webkit-appearance:none}
        .ssel option{background:#1a1625;color:var(--t1)}
        .ncb{width:100%;padding:8px 12px;border-radius:8px;border:1px solid var(--bdr-a);background:var(--acbg);color:var(--ac2);font-size:13px;cursor:pointer;font-family:var(--sans);font-weight:500;transition:all .2s}
        .ncb:hover{background:rgba(139,92,246,0.15)}
        .sdv{height:1px;background:var(--bdr);margin:8px 12px}
        .sl{flex:1;overflow-y:auto;padding:0 12px}
        .si{padding:8px 10px;border-radius:6px;margin-bottom:2px;cursor:pointer;display:flex;align-items:center;justify-content:space-between;transition:all .15s;border:1px solid transparent}
        .si:hover{background:rgba(255,255,255,0.03)}
        .si.on{background:rgba(139,92,246,0.12);border-color:var(--bdr-a)}
        .stl{font-size:12px;color:var(--t2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .si.on .stl{color:var(--ac2);font-weight:500}
        .sm{font-size:10px;color:var(--t4);margin-top:2px}
        .sdl{width:20px;height:20px;border-radius:4px;border:none;background:transparent;color:var(--t4);cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;flex-shrink:0;opacity:0;transition:opacity .15s}
        .si:hover .sdl{opacity:1}
        .sf{padding:8px 12px;border-top:1px solid var(--bdr);font-size:10px;color:var(--t4);font-family:var(--mono)}
        .ss{margin:4px 12px;padding:8px 10px;border-radius:6px;background:rgba(34,197,94,0.06);border:1px solid rgba(34,197,94,0.15);font-size:10px;font-family:var(--mono)}
        .ssl{color:var(--ok);font-weight:600;margin-bottom:4px}.ssi{color:rgba(255,255,255,0.4)}

        .ca{flex:1;display:flex;flex-direction:column;overflow:hidden;background:linear-gradient(180deg,#0c0a13 0%,#110e1a 100%)}
        .cm{flex:1;overflow-y:auto;padding:20px 24px}
        .mg{margin-bottom:16px;display:flex}
        .mg.u{justify-content:flex-end;padding-left:48px}
        .mg.a{justify-content:flex-start;padding-right:48px}
        .mc{max-width:100%}
        .mb{padding:10px 14px;font-size:14px;line-height:1.6;color:var(--t1);white-space:pre-wrap}
        .mg.u .mb{border-radius:14px 14px 4px 14px;background:linear-gradient(135deg,#7c3aed,#6d28d9)}
        .mg.a .mb{border-radius:14px 14px 14px 4px;background:var(--bg3);border:1px solid var(--bdr)}
        .mb pre{background:rgba(0,0,0,0.4);border-radius:6px;padding:12px 14px;margin:8px 0;overflow-x:auto;font-size:12px;line-height:1.5;border:1px solid rgba(255,255,255,0.06)}
        .mb code{color:#e2e8f0;font-family:var(--mono)}
        .mb .lt2{color:rgba(139,92,246,0.6);font-size:10px;margin-bottom:6px;display:block;font-family:var(--mono)}
        .ld{display:flex;gap:4px;padding:4px 0}
        .ld span{width:6px;height:6px;border-radius:50%;background:rgba(139,92,246,0.6)}
        .ld span:nth-child(1){animation:pulse 1.2s 0s infinite}
        .ld span:nth-child(2){animation:pulse 1.2s .15s infinite}
        .ld span:nth-child(3){animation:pulse 1.2s .3s infinite}

        .rb{margin-top:6px;border-radius:6px;border:1px solid rgba(139,92,246,0.15);background:rgba(139,92,246,0.04);font-size:11px;font-family:var(--mono);overflow:hidden}
        .rt{display:flex;align-items:center;gap:6px;width:100%;padding:5px 10px;border:none;background:transparent;cursor:pointer;color:rgba(139,92,246,0.8);font-size:11px;font-family:var(--mono);text-align:left}
        .ra{font-weight:600}.rdv{opacity:.3}.rmd{opacity:.5;margin-left:auto}
        .rd{padding:4px 10px 8px;border-top:1px solid rgba(139,92,246,0.1);display:none}
        .rb.ex .rd{display:block}
        .rc{display:inline-block;padding:1px 6px;border-radius:3px;background:rgba(139,92,246,0.1);color:rgba(139,92,246,0.7);font-size:10px;margin:1px 2px}
        .rr{color:rgba(255,255,255,0.4);margin-top:2px}

        .cia{padding:12px 16px;border-top:1px solid var(--bdr);background:rgba(0,0,0,0.2)}
        .ciw{display:flex;gap:8px;align-items:flex-end;background:var(--bg3);border-radius:12px;border:1px solid rgba(255,255,255,0.08);padding:8px 12px;transition:border-color .2s}
        .ciw:focus-within{border-color:rgba(139,92,246,0.3)}
        #ci{flex:1;background:transparent;border:none;outline:none;color:var(--t1);font-size:14px;font-family:var(--sans);resize:none;line-height:1.5;max-height:120px}
        #ci::placeholder{color:var(--t4)}
        .snb{width:32px;height:32px;border-radius:8px;border:none;background:rgba(255,255,255,0.06);color:var(--t4);cursor:default;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;transition:all .2s}
        .snb.on{background:linear-gradient(135deg,#7c3aed,#6d28d9);color:#fff;cursor:pointer}
        .cif{font-size:10px;color:var(--t4);text-align:center;margin-top:6px;font-family:var(--mono)}

        .wl{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:32px;text-align:center}
        .wi{width:64px;height:64px;border-radius:16px;background:linear-gradient(135deg,rgba(124,58,237,0.15),rgba(37,99,235,0.15));border:1px solid var(--bdr-a);display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:20px}
        .wl h2{font-size:22px;font-weight:700;margin-bottom:6px;letter-spacing:-0.02em}
        .wl p{font-size:13px;color:rgba(255,255,255,0.35);max-width:400px;line-height:1.5;margin-bottom:28px}
        .sg{display:grid;grid-template-columns:1fr 1fr;gap:8px;width:100%;max-width:500px}
        .sgi{padding:10px 14px;border-radius:8px;border:1px solid var(--bdr);background:rgba(255,255,255,0.02);color:rgba(255,255,255,0.4);font-size:12px;cursor:pointer;text-align:left;line-height:1.4;transition:all .2s}
        .sgi:hover{border-color:var(--bdr-a);background:var(--acbg);color:var(--ac2)}
        .wf{margin-top:32px;display:flex;gap:16px;font-size:10px;font-family:var(--mono);color:var(--t4)}
        .es{font-size:12px;color:var(--t4);padding:12px 0;text-align:center}
    </style>
</head>
<body>
<div class="app">
    <div class="topnav">
        <div class="tnl">
            <button class="sbtgl" onclick="tglSb()">‚ò∞</button>
            <div class="logo"><div class="lm">T</div><span class="lt">TORQ Console</span><span class="lv">v2.0</span></div>
        </div>
        <div class="tnr">
            <div class="pi" id="pi"><div class="pd"></div><span class="pl">Processing...</span></div>
            <div style="display:flex;align-items:center;gap:4px">
                <span class="sdot" id="sd" style="background:rgba(255,255,255,0.2)"></span>
                <span class="slbl" id="sl" style="color:var(--t3)">Connecting...</span>
            </div>
        </div>
    </div>
    <div class="mn">
        <div class="sb" id="sb">
            <div style="padding:12px 12px 8px"><button class="ncb" onclick="newSess()">+ New Chat</button></div>
            <div class="sbs">
                <div class="sbl">Agent</div>
                <select class="ssel" id="asel"><option value="prince_flowers">Prince Flowers</option><option value="orchestrator">Agent Orchestrator</option><option value="query_router">Query Router</option></select>
            </div>
            <div class="sbs" style="padding-top:8px">
                <div class="sbl">Mode</div>
                <select class="ssel" id="msel"><option value="single_agent">Single ‚Äî Route to best agent</option><option value="multi_agent">Multi ‚Äî Coordinate agents</option><option value="pipeline">Pipeline ‚Äî Sequential (stub)</option><option value="parallel">Parallel ‚Äî Concurrent (stub)</option></select>
            </div>
            <div class="ss" id="sst" style="display:none"><div class="ssl">‚óè System <span id="sst2">online</span></div><div class="ssi" id="sst3"></div></div>
            <div class="sdv"></div>
            <div style="padding:0 12px"><div class="sbl">Sessions</div></div>
            <div class="sl" id="sls"><div class="es">No sessions yet</div></div>
            <div class="sf"><div id="ac">3 agents registered</div><div>Model: claude-sonnet-4-20250514</div></div>
        </div>
        <div class="ca">
            <div class="cm" id="cms">
                <div class="wl" id="wl">
                    <div class="wi">‚ö°</div>
                    <h2>TORQ Console Dashboard</h2>
                    <p>53-agent AI orchestration system with intelligent routing, multi-provider LLM support, and swarm intelligence.</p>
                    <div class="sg">
                        <div class="sgi" onclick="useSug(this)">Write a Python function to parse JSON config files</div>
                        <div class="sgi" onclick="useSug(this)">Search for the latest AI agent frameworks</div>
                        <div class="sgi" onclick="useSug(this)">Explain the TORQ orchestrator architecture</div>
                        <div class="sgi" onclick="useSug(this)">Help me debug a FastAPI async endpoint</div>
                    </div>
                    <div class="wf"><span>FastAPI Backend</span><span>¬∑</span><span>Anthropic + OpenAI + DeepSeek</span><span>¬∑</span><span>14 Swarm Teams</span></div>
                </div>
            </div>
            <div class="cia">
                <div class="ciw"><textarea id="ci" rows="1" placeholder="Send a message to TORQ..." onkeydown="kd(event)" oninput="ub()"></textarea><button class="snb" id="snb" onclick="send()">‚Üë</button></div>
                <div class="cif">TORQ Console v2.0 ¬∑ PRD v5.1.0 ¬∑ Enter to send ¬∑ Shift+Enter for newline</div>
            </div>
        </div>
    </div>
</div>
<script>
const S={ss:[],aid:null,conn:false,busy:false,sbOn:true};
const A={
    async agents(){const r=await fetch('/api/agents');if(!r.ok)throw r;return r.json()},
    async status(){const r=await fetch('/api/status');if(!r.ok)throw r;return r.json()},
    async chat(a,m,md){const r=await fetch('/api/agents/'+a+'/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:m,mode:md})});if(!r.ok)throw r;return r.json()},
    async health(){const r=await fetch('/health');if(!r.ok)throw r;return r.json()}
};
function demo(m){
    const l=m.toLowerCase(),b={agent_id:'prince_flowers',timestamp:new Date().toISOString()};
    if(/code|function|python|implement/.test(l))return{...b,response:'```python\nfrom torq_console.agents.marvin_orchestrator import get_orchestrator\n\nasync def handle_query(query: str):\n    orchestrator = get_orchestrator()\n    result = await orchestrator.process_query(\n        query,\n        mode=OrchestrationMode.SINGLE_AGENT\n    )\n    return result.primary_response\n```\n\nThis connects to the verified orchestrator endpoint. The `get_orchestrator()` singleton initializes with `anthropic/claude-sonnet-4-20250514` by default.',metadata:{mode:'single_agent',routing_decision:{primary_agent:'prince_flowers',capabilities:['code_generation']},success:true,agent_used:'marvin_prince_flowers'}};
    if(/search|find|latest|news/.test(l))return{...b,response:'I detected this as a search query and routed it through TorqPrinceFlowers with web search tools enabled. In production, this calls the multi-API search system (Brave, Google, Tavily, Perplexity, CoinGecko) via the SwarmOrchestrator\'s 4-agent chain: Search ‚Üí Analysis ‚Üí Synthesis ‚Üí Response.',metadata:{mode:'single_agent',routing_decision:{primary_agent:'torq_prince_flowers',capabilities:['web_search','research']},success:true,agent_used:'torq_prince_flowers (with tools)',used_tools:true}};
    return{...b,response:"I'm Prince Flowers, your TORQ Console AI assistant. I can help with code generation, task planning, research, and general conversation. The dashboard is connected and routing is working. Try asking me to write code or search for something!",metadata:{mode:'single_agent',routing_decision:{primary_agent:'prince_flowers',capabilities:['general_chat']},success:true,agent_used:'marvin_prince_flowers'}};
}
async function init(){
    try{await A.health();S.conn=true;connUI(true);
        try{const a=await A.agents();const s=document.getElementById('asel');s.innerHTML=a.map(x=>'<option value="'+x.id+'">'+esc(x.name)+'</option>').join('');document.getElementById('ac').textContent=a.length+' agents registered'}catch(e){}
        try{const st=await A.status();sysUI(st)}catch(e){}
    }catch(e){S.conn=false;connUI(false)}
    setInterval(async()=>{try{const st=await A.status();sysUI(st);if(!S.conn){S.conn=true;connUI(true)}}catch(e){if(S.conn){S.conn=false;connUI(false)}}},30000);
}
function connUI(c){document.getElementById('sd').style.background=c?'var(--ok)':'rgba(255,255,255,0.2)';const l=document.getElementById('sl');l.style.color=c?'rgba(34,197,94,0.7)':'var(--t3)';l.textContent=c?'Connected':'Demo Mode'}
function sysUI(st){const e=document.getElementById('sst');e.style.display='block';document.getElementById('sst2').textContent=st.status;document.getElementById('sst3').textContent=st.agents_active+' agents ¬∑ '+Math.floor(st.uptime_seconds/60)+'m uptime'}
function proc(on){S.busy=on;document.getElementById('pi').classList.toggle('on',on);document.getElementById('ci').disabled=on;ub()}
function ub(){const b=document.getElementById('snb'),v=document.getElementById('ci').value.trim();b.classList.toggle('on',v.length>0&&!S.busy)}
function tglSb(){S.sbOn=!S.sbOn;document.getElementById('sb').classList.toggle('off',!S.sbOn)}
function getSess(){return S.ss.find(s=>s.id===S.aid)||null}
function newSess(t){const id='s-'+Date.now()+'-'+Math.random().toString(36).slice(2,6);const s={id,title:t||'Chat '+(S.ss.length+1),msgs:[],ts:Date.now()};S.ss.push(s);S.aid=id;rSess();rMsgs();return s}
function setSess(id){S.aid=id;rSess();rMsgs()}
function delSess(id,ev){if(ev)ev.stopPropagation();S.ss=S.ss.filter(s=>s.id!==id);if(S.aid===id)S.aid=S.ss.length?S.ss[0].id:null;rSess();rMsgs()}
function rSess(){const e=document.getElementById('sls');if(!S.ss.length){e.innerHTML='<div class="es">No sessions yet</div>';return}
    e.innerHTML=S.ss.map(s=>'<div class="si'+(s.id===S.aid?' on':'')+'" onclick="setSess(\''+s.id+'\')"><div style="overflow:hidden;flex:1"><div class="stl">'+esc(s.title)+'</div><div class="sm">'+s.msgs.length+' messages</div></div><button class="sdl" onclick="delSess(\''+s.id+'\',event)">√ó</button></div>').join('')}
function rMsgs(){const c=document.getElementById('cms'),s=getSess(),w=document.getElementById('wl');
    c.querySelectorAll('.mg').forEach(m=>m.remove());
    if(!s||!s.msgs.length){if(w)w.style.display='flex';return}
    if(w)w.style.display='none';
    s.msgs.forEach(m=>{const d=document.createElement('div');d.className='mg '+(m.role==='user'?'u':'a');d.innerHTML=mHTML(m);c.appendChild(d)});
    c.scrollTop=c.scrollHeight}
function mHTML(m){
    if(m.ld)return'<div class="mc"><div class="mb"><div class="ld"><span></span><span></span><span></span></div></div></div>';
    let t=esc(m.content);
    t=t.replace(/```(\w*)\n([\s\S]*?)```/g,(_,l,c)=>'<pre>'+(l?'<span class="lt2">'+l+'</span>':'')+('<code>'+c+'</code>')+'</pre>');
    let badge='';
    if(m.role!=='user'&&m.meta)badge=rBadge(m);
    return'<div class="mc"><div class="mb">'+t+'</div>'+badge+'</div>'}
function rBadge(m){
    const mt=m.meta||{},rt=mt.routing_decision||{},ag=mt.agent_used||rt.primary_agent||'unknown',caps=rt.capabilities||[],md=mt.mode||'single_agent',ok=mt.success!==false,tl=mt.used_tools||false,id='rb'+m.id;
    const ch=caps.map(c=>'<span class="rc">'+c.replace(/_/g,' ')+'</span>').join('');
    const ar=mt.agent_used?'<div class="rr">agent: '+mt.agent_used+'</div>':'';
    return'<div class="rb" id="'+id+'"><button class="rt" onclick="document.getElementById(\''+id+'\').classList.toggle(\'ex\')"><span style="font-size:9px">‚ñ∏</span><span class="ra">'+ag.replace(/_/g,' ')+'</span><span class="rdv">‚îÇ</span><span style="color:'+(ok?'var(--ok)':'var(--err)')+'">'+(ok?'‚úì':'‚úó')+'</span>'+(tl?'<span>üîß</span>':'')+'<span class="rmd">'+md.replace(/_/g,' ')+'</span></button><div class="rd">'+(ch?'<div style="margin-bottom:4px">'+ch+'</div>':'')+ar+'</div></div>'}
async function send(){
    const inp=document.getElementById('ci'),txt=inp.value.trim();if(!txt||S.busy)return;inp.value='';ub();
    let s=getSess();if(!s)s=newSess(txt.slice(0,40));else if(!s.msgs.length){s.title=txt.slice(0,40);rSess()}
    s.msgs.push({id:'m'+Date.now()+'u',role:'user',content:txt,ts:Date.now()});
    const lid='m'+Date.now()+'a';s.msgs.push({id:lid,role:'assistant',content:'',ts:Date.now(),ld:true});rMsgs();proc(true);
    try{let r;if(S.conn){r=await A.chat(document.getElementById('asel').value,txt,document.getElementById('msel').value)}else{await new Promise(r=>setTimeout(r,800+Math.random()*1200));r=demo(txt)}
        const i=s.msgs.findIndex(m=>m.id===lid);if(i>=0)s.msgs[i]={id:lid,role:'assistant',content:r.response,ts:Date.now(),meta:r.metadata,ld:false}
    }catch(e){const i=s.msgs.findIndex(m=>m.id===lid);if(i>=0)s.msgs[i]={id:lid,role:'assistant',content:'Error: '+e.message+'. Backend may not be running.',ts:Date.now(),ld:false}}
    proc(false);rMsgs();rSess()}
function useSug(el){document.getElementById('ci').value=el.textContent;ub();send()}
function kd(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send()}}
function esc(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
